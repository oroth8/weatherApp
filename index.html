<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <!-- css -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/style.css">
    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <!-- Jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
</head>
<header>
    <nav class="navbar navbar-light bg-light">
        <span class="navbar-brand mb-0 h1">Weather App</span>
      </nav>
</header>
<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <nav class="navbar navbar-light bg-light">
                    <form class="form-inline">
                      <input class="form-control mr-sm-2" id="search" placeholder="Search" aria-label="Search">
                      <button class="btn btn-outline-success my-2 my-sm-0" id="btn" type="submit">Search</button>
                    </form>
                  </nav>
                  <ul class="list-group">
                  </ul>
            </div>
            <div class="col-md-8">
                <div id="dayW">
                    <h2 id="date"></h2>
                </div>
                <div class="row" id="forecastContainer">
                    <div class="col-md-2 box" id="box0"></div>
                    <div class="col-md-2 box" id="box1"></div>
                    <div class="col-md-2 box" id="box2"></div>
                    <div class="col-md-2 box" id="box3"></div>
                    <div class="col-md-2 box" id="box4"></div>
                </div>
            </div>
            
        </div>
    </div>
<script>
$( document ).ready(function() {

    var cities = [];

    $("#btn").on("click", function(event){
        event.preventDefault();
        var userInput = $("#search").val().toUpperCase().trim();
        newBtn = $("<button>");
        newBtn.attr("class", "list-group-item list-group-item-action");
        newBtn.attr("type", "button");
        newBtn.attr("id", "btnLi");
        newBtn.text(userInput);
        $(".list-group").append(newBtn);
        cities.push(userInput);
        console.log(cities);
        displayWeather(userInput);
        displayForecast(userInput);
        
        cities = [];
        });

     $(document).on("click", ".list-group-item", activeBtn);

    function activeBtn(){
        $(".list-group-item").attr("class", "list-group-item list-group-item-action");
        $(this).attr("class", "list-group-item list-group-item-action active");
        displayWeather($(this).text());
        displayForecast($(this).text());
        }

    function displayWeather(city){
        var APIKey = "0802b43ec08a1502c85c76efb5c718a5";
        var queryURL = "https://api.openweathermap.org/data/2.5/weather?q="+city+"&appid=" + APIKey;
        // We then created an AJAX call
        $.ajax({
        url: queryURL,
        method: "GET"
        }).then(function(response) {
        console.log(response);
        console.log(response.main.temp);
        console.log(response.main.humidity);
        console.log(response.wind.speed);

        var tempK = response.main.temp;
        var tempCalc = ((tempK - 273.15) * 9/5 + 32).toFixed(0);

        var tempKH = response.main.temp_max;
        var tempCalcH = ((tempK - 273.15) * 9/5 + 32).toFixed(0);

        var tempKL = response.main.temp_min;
        var tempCalcL = ((tempK - 273.15) * 9/5 + 32).toFixed(0);

        var cityH1=$("<h1>").text(city);
        var temp=$("<h4>").text("Current Temperature: "+tempCalc+"F");
            temp.attr("id", "temp");
        var tempH=$("<h4>").text("High: "+tempCalc+"F");
        var tempL=$("<h4>").text("Low: "+tempCalc+"F");
        var humidity=$("<h4>").text("Humidity: "+response.main.humidity+"%");
        var wind=$("<h4>").text("Wind Speed: "+response.wind.speed+" MPH");

        $("#dayW").empty();

        displayDate();
        displayUV(response.coord.lon,response.coord.lat);

        $("#dayW").append(cityH1);
        $("#dayW").append(temp);
        $("#dayW").append(tempH);
        $("#dayW").append(tempL);
        $("#dayW").append(humidity);
        $("#dayW").append(wind);

        

        });
        }
    function displayForecast(city){  
        $("#forecastContainer").attr("style", "visibility: visible;");
        var fiveDay = new Date();
        var month = fiveDay.getMonth()+1;
        var today = fiveDay.getDate();
        var weekday = new Array(7);
            weekday[0] = "Sunday";
            weekday[1] = "Monday";
            weekday[2] = "Tuesday";
            weekday[3] = "Wednesday";
            weekday[4] = "Thursday";
            weekday[5] = "Friday";
            weekday[6] = "Saturday";

        // console.log(fiveDay.getDay());
        // for(var i=0;i<5;i++){
        //     if(fiveDay.getDay())
        // }

        var APIKey = "0802b43ec08a1502c85c76efb5c718a5";
        var queryURL = "http://api.openweathermap.org/data/2.5/forecast?q="+city+"&appid=" + APIKey;
        // We then created an AJAX call
        $.ajax({
        url: queryURL,
        method: "GET"
        }).then(function(response) {
        console.log(response);
        var dayCount = 0;
        for(var i=0;i<response.list.length;i+=4){

            var tempK = response.list[i].main.temp;
            var tempCalc = ((tempK - 273.15) * 9/5 + 32).toFixed(0);

            var temp = $("<h6>").text("Temp: "+tempCalc+" F"); 
            var humidity = $("<h6>").text(response.list[i].main.humidity+" %");
            var wind = $("<h6>").text(response.list[i].wind.speed+" MPH");

        $("#box"+dayCount).empty();    
        
        display5Days(dayCount);        

        $("#box"+dayCount).append(temp);
        $("#box"+dayCount).append(humidity);
        $("#box"+dayCount).append(wind);
        dayCount++;
        }

        })}
        

    function displayDate(){
    var fullDate = new Date();
    console.log(fullDate.getMonth());
    var dateH2 = $("<h2>");
    dateH2.text("Today's Date: "+(fullDate.getMonth()+1)+"/"+(fullDate.getDate())+"/"+ (fullDate.getFullYear()));
    $("#dayW").append(dateH2);

    
    }

    function display5Days(day){
        let days = [];
        let daysRequired = 7

        for (let i = 1; i <= daysRequired; i++) {
            // 'dddd, Do MMMM YYYY'
         days.push( moment().add(i, 'days').format('dddd, Do') )
            }
        $("#box"+day).append(days[day]);
            console.log(days)
    }

    $("#btn").on("click", function(){
        var lastInput = $("#search").val().toUpperCase().trim();
        localStorage.setItem("LastSearch", lastInput);
    })

    function displayLastSearch(){
        lastSearch = localStorage.getItem("LastSearch");
        $("#search").val(lastSearch);
    }
    displayLastSearch();

    function displayUV(lon,lat){
        var APIKey = "0802b43ec08a1502c85c76efb5c718a5";
        var queryURL = "http://api.openweathermap.org/data/2.5/uvi?lat="+lat+"&lon="+lon+"&appid="+APIKey;
        // We then created an AJAX call
        $.ajax({
        url: queryURL,
        method: "GET"
        }).then(function(response) { 
            console.log("YESSSSSSSS");
            
            var uvIndex = response.value;

            $("#temp").append($("<span id=UV></span>"));

            uvDisplay = $("<h1 id=uv-val>").text("UV Index: "+uvIndex);
            $("#UV").append(uvDisplay);

            if(uvIndex<=2){
                $("#uv-val").attr("style", "color: #28a745;");
            }
            else if(uvIndex>2 && uvIndex<=5){
                $("#uv-val").attr("style", "color: #ffc107;");
            }
            else if(uvIndex>5){
                $("#uv-val").attr("style", "color: #dc3545;");
            }
            

        

        });
    }



    });

</script>
    
</body>
</html>